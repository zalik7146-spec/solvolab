<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Äî Solvo</title>
  <link rel="stylesheet" href="css/styles.css"/>
  <link rel="manifest" href="manifest.webmanifest"/>
  <meta name="theme-color" content="#ffffff"/>
</head>
<body>
<header class="header container">
  <a class="back" href="app.html">‚Üê</a>
  <div class="brand">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
  <div style="width:44px"></div>
</header>

<main class="container page">
  <div class="card" style="display:grid;gap:12px">
    <div class="row">
      <button class="button" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
      <label class="button" style="cursor:pointer">
        –ò–º–ø–æ—Ä—Ç JSON
        <input type="file" id="importFile" accept="application/json" style="display:none"/>
      </label>
    </div>
    <small class="tag">–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage –ø—Ä–µ—Ñ–∏–∫—Å–∞ <b>solvo:</b></small>
  </div>

  <div class="card" style="display:grid;gap:12px">
    <div class="row">
      <button class="button" id="loginBtn">–í–æ–π—Ç–∏ (Supabase)</button>
      <button class="button" id="logoutBtn" style="display:none">–í—ã–π—Ç–∏</button>
    </div>
    <small class="tag">–î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —É–∫–∞–∂–∏ –∫–ª—é—á–∏ –≤ <b>js/supabase.js</b>.</small>
  </div>

  <div class="card" style="display:grid;gap:12px">
    <div class="row">
      <input class="input" id="dolEmail" placeholder="E‚Äëmail Dolumai"/>
      <input class="input" id="dolToken" placeholder="API —Ç–æ–∫–µ–Ω Dolumai"/>
      <button class="button" id="saveDol">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
    <small class="tag">Dolumai –≤—Ö–æ–¥: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–ª—è –±—É–¥—É—â–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.</small>
  </div>
</main>

<nav class="tabs">
  <div class="tabbar">
    <a class="tab" href="app.html">üè†</a>
    <a class="tab" href="tasks.html">üìù</a>
    <a class="tab" href="focus.html">‚è±</a>
    <a class="tab" href="calendar.html">üìÖ</a>
    <a class="tab" href="someday.html">üï∞</a>
  </div>
</nav>

<script src="js/storage.js"></script>
<script src="js/common.js"></script>
<script src="js/supabase.js"></script>
<script>
  document.getElementById('exportBtn').onclick = () => {
    const data = DB.snapshot();
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `solvo-backup-${new Date().toISOString().slice(0,10)}.json`;
    a.click();
    URL.revokeObjectURL(a.href);
  };
  document.getElementById('importFile').addEventListener('change', async (e)=>{
    const file = e.target.files?.[0]; if(!file) return;
    try {
      const text = await file.text();
      const data = JSON.parse(text);
      DB.mergeFromCloud(data);
      alert('–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω. –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã.');
    } catch (e) {
      alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ' + (e?.message||e));
    }
  });

  // Dolumai mock credentials storage
  const dolEmail = document.getElementById('dolEmail');
  const dolToken = document.getElementById('dolToken');
  const saveDol = document.getElementById('saveDol');
  function loadDol(){
    const cfg = DB.get('dolumai:cfg', { email:'', token:'' });
    dolEmail.value = cfg.email||'';
    dolToken.value = cfg.token||'';
  }
  saveDol.onclick = ()=>{
    const email = (dolEmail.value||'').trim();
    const token = (dolToken.value||'').trim();
    if(!email || !token){ alert('–£–∫–∞–∂–∏ e‚Äëmail –∏ —Ç–æ–∫–µ–Ω'); return; }
    DB.set('dolumai:cfg', { email, token, saved_at: new Date().toISOString() });
    alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Dolumai —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ.');
  };
  loadDol();
</script>
</body>
</html>